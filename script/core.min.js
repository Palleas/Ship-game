var Ship,Enemy,Bullet,Universe,Keys;Keys={ACCELERATE:38,BRAKE:40,TURN_LEFT:37,TURN_RIGHT:39,FIRE:32};Universe=new function(){this.ANSWER=42;var k=document.getElementById("stage"),b=document.getElementById("background"),f,c=[],d=[],i=[Keys.ACCELERATE,Keys.BRAKE,Keys.TURN_RIGHT,Keys.TURN_LEFT,Keys.FIRE];options={};function l(){var o,n;o=new Point(Math.floor(Math.random()*k.width),Math.floor(Math.random()*k.height));n=new Enemy(1,o,Math.random()*Math.PI);c.push(n);setTimeout(l,Math.random()*1500)}function g(){var p,n;p=b.getContext("2d");p.save();p.fillStyle="#000";p.rect(0,0,b.width,b.height);p.fill();p.restore();function o(q,r){p.strokeStyle="rgba(255, 255, 255, "+Math.random()+")";p.save();p.translate(q,r);p.rotate(Math.random()*Math.PI);p.moveTo(-2,0);p.lineTo(2,0);p.moveTo(0,-2);p.lineTo(0,2);p.stroke();p.restore()}for(n=0;n<Math.random()*200;n++){o(Math.random()*b.width,Math.random()*b.height)}}function a(n){if(i.indexOf(n.keyCode)>-1){n.preventDefault()}else{return}switch(n.keyCode){case Keys.ACCELERATE:if(!f.accelerating){f.accelerating=true}break;case Keys.BRAKE:if(!f.braking){f.braking=true}break;case Keys.TURN_LEFT:if(!f.turningLeft){f.turningLeft=true}break;case Keys.TURN_RIGHT:if(!f.turningRight){f.turningRight=true}break;case Keys.FIRE:if(!f.firing){f.firing=true}break}}function e(n){if(i.indexOf(n.keyCode)>-1){n.preventDefault()}else{return}switch(n.keyCode){case Keys.ACCELERATE:if(f.accelerating){f.accelerating=false}break;case Keys.BRAKE:if(f.braking){f.braking=false}break;case Keys.TURN_LEFT:if(f.turningLeft){f.turningLeft=false}break;case Keys.TURN_RIGHT:if(f.turningRight){f.turningRight=false}break;case Keys.FIRE:if(f.firing){f.firing=false}break}}function j(n){if(!n.position){return false}return n.position.x<0||n.position.x>k.width||n.position.y<0||n.position.y>k.height}function h(){k.getContext("2d").clearRect(0,0,k.width,k.height)}function m(){h();var p,o,n,q,r=k.getContext("2d");if(f.firing&&f.canShoot()){d.push(f.fire())}if(f.accelerating){f.accelerate()}if(f.braking){f.brake()}if(f.turningLeft){f.turnLeft()}if(f.turningRight){f.turnRight()}f.updateCoordinates();f.slowDown(0.96);f.draw(r);for(p=0;p<d.length;p++){n=d[p];n.updateCoordinates();if(n.position.x<0||n.position.x>k.width||n.position.y<0||n.position.y>k.height){d.splice(p,1);continue}n.draw(r)}for(p=0;p<c.length;p++){q=c[p];q.updateCoordinates();if(j(q)){c.splice(p,1);continue}for(o=0;o<d.length;o++){n=d[o];if(q.destroyed){c.splice(o,1);continue}else{if(n.position.x>q.position.x&&n.position.x<(q.position.x+20)&&n.position.y>q.position.y&&n.position.y<(q.position.y+20)&&!q.destroyCount){q.destroy()}}}q.draw(r)}}this.init=function(){g();f=new Ship();f.position.x=k.width/2;f.position.y=k.height/2;f.image=new Image();f.image.src="assets/images/ship.png";f.image.addEventListener("load",function(){document.addEventListener("keyup",e,false);document.addEventListener("keydown",a,false)});setInterval(m,1000/60);setTimeout(l,Math.random()*1500)}};Bullet=function(a,c){this.position=new Point(a.x,a.y);this.rotation=c;var d,b;d=Math.sin((c*Math.PI)/180)*15;b=-Math.cos((c*Math.PI)/180)*15;this.updateCoordinates=function(){this.position.x+=d;this.position.y+=b};this.draw=function(e){e.save();e.translate(this.position.x,this.position.y);e.rotate((this.rotation*Math.PI)/180);e.fillStyle="rgba(0, 255, 0, 1)";e.beginPath();e.rect(-2,0,4,10);e.fill();e.restore()}};Enemy=function(e,a,c){this.life=e*5;this.position=a;this.rotation=c;this.destroyCount=0;this.destroyed=false;var d,b;d=Math.sin(this.rotation)*(2*e);b=-Math.cos(this.rotation)*(2*e);this.updateCoordinates=function(){this.position.x+=d;this.position.y+=b};this.destroy=function(){this.destroyCount=30};this.draw=function(f){f.save();f.translate(this.position.x,this.position.y);f.rotate(this.rotation);if(this.destroyCount==0&&!this.destroyed){f.beginPath();f.fillStyle="rgba(0, 0, 255, 1)";f.arc(0,0,10,0,Math.PI*2,false);f.fill()}else{this.destroyCount--;if(this.destroyCount<=0){this.destroyed=true}else{f.beginPath();f.strokeStyle="rgba(0, 255, 0, "+Math.random()+")";f.moveTo(0,-20);f.lineTo(-5,-5);f.lineTo(-20,0);f.lineTo(-5,5);f.lineTo(0,20);f.lineTo(5,5);f.lineTo(20,0);f.lineTo(5,-5);f.lineTo(0,-20);f.stroke()}}f.restore()}};Ship=function(){this.trail=[];this.speed=0;this.life=0;this.rotation=0;this.position=new Point(0,0);this.lastShoot=0;this.firing=false;this.accelerating=false;this.braking=false;this.turningLeft=false;this.turningRight=false;this.image=null;this.accelerate=function(){var a=this.speed+2;this.speed=a<=10?a:10};this.slowDown=function(a){this.speed*=a};this.brake=function(){var a=this.speed-2;this.speed=a>0?a:0};this.turn=function(a){this.rotation+=a=="right"?8:-8};this.turnLeft=function(){this.turn("left")};this.turnRight=function(){this.turn("right")};this.canShoot=function(){var a=new Date().getTime()-this.lastShoot;return a>200};this.fire=function(){this.lastShoot=new Date().getTime();var a=new Bullet(this.position,this.rotation);return a};this.draw=function(a){a.save();a.translate(this.position.x,this.position.y);a.rotate((this.rotation*Math.PI)/180);a.drawImage(this.image,this.image.width*-0.5,this.image.height*-0.5);a.restore()}};Ship.prototype.updateCoordinates=function(){var b,a;b=Math.sin((this.rotation*Math.PI)/180)*this.speed;a=-Math.cos((this.rotation*Math.PI)/180)*this.speed;this.position.x+=b;this.position.y+=a};window.addEventListener("load",function(d){var c=document.getElementById("playButton"),b=document.getElementById("modal"),a=document.getElementById("presentation");c.addEventListener("click",function(e){b.parentNode.removeChild(b);a.parentNode.removeChild(a);Universe.init();return false},false)},false);