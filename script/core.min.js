var KEY_UP=38,KEY_DOWN=40,KEY_LEFT=37,KEY_RIGHT=39,KEY_FIRE=32,SHIP_IMAGE_SRC="assets/images/ship.png",BULLET_SPEED=10,Bullet,Ship,GameContext,context;Bullet=function(a){this.rotation=a;this.position={x:0,y:0};this.clock=0;this.xAcc=Math.sin((a*Math.PI)/180)*BULLET_SPEED;this.yAcc=-Math.cos((a*Math.PI)/180)*BULLET_SPEED};Bullet.prototype.move=function(){this.position.x+=this.xAcc;this.position.y+=this.yAcc};Bullet.prototype.destroy=function(){clearInterval(this.clock);this.clock=0;this.xAcc=0;this.yAcc=0};Ship=function(){this.position={x:0,y:0};this.life=100;this.rotation=0;this.currentSpeed=0};Ship.prototype.move=function(){var b,a;b=Math.sin((this.rotation*Math.PI)/180)*this.currentSpeed;a=-Math.cos((this.rotation*Math.PI)/180)*this.currentSpeed;this.position.x+=b;this.position.y+=a};Ship.prototype.accelerate=function(){this.currentSpeed+=2;if(this.currentSpeed>=10){this.currentSpeed=10}};Ship.prototype.turnLeft=function(){this.rotation-=5};Ship.prototype.turnRight=function(){this.rotation+=5};GameContext=function(g){var a=g.getContext("2d"),c=0,h=new Date().getTime(),e={},d=[];shipImage=null,draco=null;shipImage=new Image(),shipImage.src=SHIP_IMAGE_SRC,draco=new Ship();draco.position.x=parseInt(g.width/2);draco.position.y=parseInt(g.height/2);d=[];e={game:null,paint:null,resist:null,moving:null,rotatingLeft:null,rotatingRight:null,firing:null};function j(o){if(o.keyCode==KEY_FIRE&&!e.firing){e.firing=setInterval(b,100)}if(o.keyCode==KEY_UP&&!e.moving){e.moving=setInterval(function(){draco.accelerate()},20)}if(o.keyCode==KEY_LEFT&&!e.rotatingLeft){e.rotatingLeft=setInterval(function(){draco.turnLeft()},20)}if(o.keyCode==KEY_RIGHT&&!e.rotatingRight){e.rotatingRight=setInterval(function(){draco.turnRight()},20)}}function n(o){if(o.keyCode==KEY_FIRE&&e.firing){clearInterval(e.firing);e.firing=0;return}if(o.keyCode==KEY_UP&&e.moving){clearInterval(e.moving);e.moving=0;return}if(o.keyCode==KEY_RIGHT&&e.rotatingRight){clearInterval(e.rotatingRight);e.rotatingRight=0;return}if(o.keyCode==KEY_LEFT&&e.rotatingLeft){clearInterval(e.rotatingLeft);e.rotatingLeft=0;return}}function m(){draco.currentSpeed*=0.92}function b(){var o=new Bullet(draco.rotation);o.position.x=draco.position.x;o.position.y=draco.position.y;o.clock=setInterval(function(){o.move()},20);d.push(o)}function k(){f();var p,q,o;for(o=0;o<d.length;o++){p=d[o];if(p.position.x<0||p.position.x>g.width||p.position.y<0||p.position.y>g.height){d.splice(o,1);continue}i(p)}l();q=new Date().getTime();c=Math.floor(1000/(q-h));h=q}function l(){a.save();a.translate(draco.position.x,draco.position.y);a.rotate(draco.rotation*Math.PI/180);a.drawImage(shipImage,-shipImage.width/2,-shipImage.height/2);a.restore()}function i(o){a.save();a.translate(o.position.x,o.position.y);a.rotate(o.rotation*Math.PI/180);a.beginPath();a.fillStyle="rgba(255, 224, 80, 1)";a.rect(0,0,2,5);a.fill();a.restore()}function f(){a.clearRect(0,0,g.width,g.height);a.fillRect(0,0,g.width,g.height)}this.getFPS=function(){return c};this.init=function(){document.addEventListener("keydown",j,false);document.addEventListener("keyup",n,false);e.game=setInterval(function(){draco.move()},10);e.paint=setInterval(k,1000/30);e.resist=setInterval(m,30)}};context=new GameContext(document.getElementById("stage")),messages=document.getElementById("messages"),link=document.createElement("a");link.href="#play";link.id="playLink";link.appendChild(document.createTextNode("Play !"));link.addEventListener("click",function(a){context.init();this.parentNode.removeChild(this);var b=document.createElement("span");b.id="fps";messages.appendChild(b);setInterval(function(){b.innerHTML=context.getFPS()+" FPS"},500);return false},false);messages.appendChild(link);